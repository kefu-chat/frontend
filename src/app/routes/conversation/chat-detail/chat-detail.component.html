<div class="content-header"></div>
<div nz-row class="content-chat">
  <div nz-col class="chat-left">
    <div class="conversation">
      <div class="message">
        <nz-divider *ngIf="has_previous" [nzText]="previous"></nz-divider>
        <ng-template #previous>
          <a (click)="loadPreMore()" style="font-size: 13px;">显示更早的消息</a>
        </ng-template>
        <div *ngFor="let item of messageList" [ngClass]="item.sender_type_text">
          <nz-comment
            [nzAuthor]="
              item.sender_type_text == 'user'
                ? item.sender_id == user.id
                  ? '你'
                  : item.sender.name
                : item.sender.name
            "
            [nzDatetime]="item.created_at | _date: 'yyyy-mm-dd HH:mm:ss'"
          >
            <nz-comment-content style="width: 95%;">
              <div class="cell" *ngIf="item.type == 1">{{ item.content }}</div>
              <div *ngIf="item.type == 2">
                <img [src]="item.content" alt="" class="img" />
              </div>
            </nz-comment-content>
            <nz-avatar
              nz-comment-avatar
              nzIcon="user"
              [nzSrc]="
                item.sender_type_text == 'user'
                  ? item.sender.photo_url
                  : '//zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png'
              "
            ></nz-avatar>
          </nz-comment>
        </div>
      </div>
      <div class="messageIupt">
        <div class="input-left">
          <textarea
            nz-input
            placeholder="请输入..."
            style="height: 110px;"
            (keydown.enter)="keyEnter($event)"
            [(ngModel)]="content"
          ></textarea>
        </div>
        <div nz-row style="height: 40px; width: 100%; position: relative;">
          <div nz-col class="input-right">
            <a
              class="send"
              [class.canSend]="content || fileList.length > 0"
              (click)="sendMessage()"
            >
              <i nz-icon nzType="send" nzTheme="outline"></i>
            </a>
            <a>
              <i nz-icon nzType="smile" nzTheme="outline"></i>
            </a>
            <a>
              <i nz-icon nzType="thunderbolt" nzTheme="outline"></i>
            </a>
            <nz-upload
              nzAction="api/file/upload"
              (nzChange)="handleChange($event)"
              style="float: right;"
              [(nzFileList)]="fileList"
            >
              <a>
                <i nz-icon nzType="paper-clip" nzTheme="outline"></i>
              </a>
            </nz-upload>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div nz-col class="visitor-details"></div>
</div>
